<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è–èª•è½‰ç›¤æŠ½ç</title>
    <style>
        :root {
            --christmas-red: #D32F2F;
            --christmas-green: #2E7D32;
            --christmas-gold: #FFD700;
            --bg-gradient: radial-gradient(circle, #8E0E00, #1F1C18);
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-gradient);
            color: white;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .main-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        h1 {
            color: var(--christmas-gold);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            margin: 10px 0;
            font-size: 1.8rem;
            text-align: center;
        }

        .game-container {
            position: relative;
            width: 80vmin; 
            height: 80vmin;
            max-width: 500px;
            max-height: 500px;
            margin: 10px auto;
            flex-shrink: 0;
        }

        #wheelCanvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            border: 8px solid #F8B400;
            box-sizing: border-box;
        }

        .pointer {
            position: absolute;
            top: -15%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            width: 10vmin;
            height: 12vmin;
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='50' viewBox='0 0 40 50' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 50L0 10C0 4.5 4.5 0 10 0H30C35.5 0 40 4.5 40 10L20 50Z' fill='%23FF3E3E' stroke='white' stroke-width='2'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-size: contain;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.5));
        }

        .controls {
            text-align: center;
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #spinBtn {
            background: linear-gradient(180deg, #FFD700, #FDB931);
            border: 2px solid #FFF;
            padding: 15px 50px;
            color: #8B0000;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #B8860B, 0 10px 10px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }

        #spinBtn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #B8860B, 0 4px 4px rgba(0,0,0,0.3);
        }

        #spinBtn:disabled {
            background: #999;
            box-shadow: none;
            color: #555;
            cursor: not-allowed;
        }

        .fullscreen-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            color: rgba(255,255,255,0.7);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        @media (orientation: landscape) {
            .main-wrapper {
                flex-direction: row;
                justify-content: space-evenly;
                gap: 20px;
            }

            .game-container {
                width: 85vh;
                height: 85vh;
                margin: 0;
            }

            .info-panel {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                max-width: 300px;
            }
            
            h1 {
                font-size: 2.5rem;
                margin-bottom: 30px;
            }
        }

        #resultModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 100;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #fff, #f8f8f8);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 80%;
            width: 450px;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.4);
            border: 5px solid #D32F2F;
            color: #333;
            position: relative;
        }

        .prize-title {
            font-size: 2rem;
            color: #D32F2F;
            margin: 10px 0;
            font-weight: bold;
        }

        .prize-desc {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .staff-check-box {
            background-color: #FFF3E0;
            border: 2px dashed #FF9800;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .staff-check-text {
            color: #E65100;
            font-weight: bold;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .close-btn {
            background: #757575;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .close-btn:hover {
            background: #424242;
        }

    </style>
</head>
<body>

    <div class="main-wrapper">
        <div class="game-container">
            <div class="pointer"></div>
            <canvas id="wheelCanvas" width="800" height="800"></canvas>
        </div>

        <div class="info-panel controls">
            <h1>ğŸ„ è–èª•å¥½é‹è½‰å‡ºä¾† ğŸ„</h1>
            <button id="spinBtn" onclick="spinWheel()">ç«‹å³é–‹è½‰</button>
            <br>
            <button class="fullscreen-btn" onclick="toggleFullScreen()">åˆ‡æ›å…¨è¢å¹•æ¨¡å¼</button>
        </div>
    </div>

    <div id="resultModal">
        <div class="modal-content">
            <h2>ğŸ‰ æ­å–œç²å¾— ğŸ‰</h2>
            <div class="prize-title" id="modalPrizeName"></div>
            <div class="prize-desc" id="modalPrizeDesc"></div>
            
            <div class="staff-check-box">
                <div class="staff-check-text">
                    âš ï¸ è«‹ä¿ç•™æ­¤ç•«é¢<br>
                    å‡ºç¤ºçµ¦åº—å“¡æ ¸éŠ·å…Œæ›
                </div>
                <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                    (æ ¸éŠ·å‰è«‹å‹¿é—œé–‰è¦–çª—)
                </div>
            </div>

            <button class="close-btn" onclick="closeModal()">åº—å“¡æ ¸éŠ·å®Œæˆ (é—œé–‰)</button>
        </div>
    </div>

    <script>
        // --- è¨­å®šå€ ---
        const prizes = [
            { id: 1, text: "è²·ä¸€é€ä¸€", fullText: "å’–å•¡å„å“é …è²·ä¸€é€ä¸€", prob: 0.05, color: "#FBC02D", textColor: "#8B0000" },
            { id: 2, text: "é‘°åŒ™åœˆ(åŠæ©‹)", fullText: "å…§ç£é™å®šå£“å…‹åŠ›é‘°åŒ™åœˆ(åŠæ©‹æ¬¾)", prob: 0.20, color: "#2E7D32", textColor: "#FFFFFF" },
            { id: 3, text: "ç±³é¤…ä¸€ç‰‡", fullText: "ç±³é¤…ä¸€ç‰‡", prob: 0.30, color: "#C62828", textColor: "#FFFFFF" },
            { id: 4, text: "æ¿¾æ›å’–å•¡", fullText: "æ¿¾æ›å’–å•¡ä¸€åŒ…", prob: 0.15, color: "#2E7D32", textColor: "#FFFFFF" },
            { id: 5, text: "ç¾å¼ä¸€æ¯", fullText: "ç¾å¼ä¸€æ¯", prob: 0.05, color: "#C62828", textColor: "#FFFFFF" },
            { id: 6, text: "é‘°åŒ™åœˆ(è»Šç«™)", fullText: "å…§ç£é™å®šå£“å…‹åŠ›é‘°åŒ™åœˆ(è»Šç«™æ¬¾)", prob: 0.21, color: "#2E7D32", textColor: "#FFFFFF" },
            { id: 7, text: "æŠ˜æŠµé‡‘40", fullText: "æ–‡å‰µå•†å“æŠ˜æŠµé‡‘40å…ƒ(é™ç•¶æ—¥)", prob: 0.02, color: "#FBC02D", textColor: "#8B0000" },
            { id: 8, text: "æŠ˜æŠµé‡‘50", fullText: "å…¨åº—å•†å“æŠ˜æŠµé‡‘50å…ƒ(ä¸é™é‡‘é¡)", prob: 0.02, color: "#C62828", textColor: "#FFFFFF" }
        ];

        const totalProb = prizes.reduce((sum, item) => sum + item.prob, 0);

        // --- éŸ³æ•ˆè¨­å®š (ä½¿ç”¨ CDN é€£çµä»¥ç¢ºä¿è®€å–é †åˆ©) ---
        // è½‰å‹•ä¸­éŸ³æ•ˆ
        const spinSound = new Audio("https://raw.githubusercontent.com/putsuketsu-dev/lottery/main/turnsound.wav");
        spinSound.loop = true; // è¨­å®šå¾ªç’°æ’­æ”¾

        // ä¸­çéŸ³æ•ˆ
        const winSound = new Audio("https://raw.githubusercontent.com/putsuketsu-dev/lottery/main/winsound.mp3");

        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const size = 800;
        const centerX = size / 2;
        const centerY = size / 2;
        const radius = size / 2 - 10;
        
        let currentRotation = 0;
        let isSpinning = false;
        const sliceAngle = 360 / prizes.length;

        function drawWheel() {
            const startAngleOffset = -Math.PI / 2;

            prizes.forEach((prize, i) => {
                const startAngle = (i * sliceAngle) * (Math.PI / 180) + startAngleOffset;
                const endAngle = ((i + 1) * sliceAngle) * (Math.PI / 180) + startAngleOffset;

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.fillStyle = prize.color;
                ctx.fill();
                
                ctx.strokeStyle = "#F8B400";
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + (endAngle - startAngle) / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = prize.textColor;
                ctx.font = "bold 36px 'Microsoft JhengHei', sans-serif";
                
                if(prize.textColor === "#FFFFFF") {
                    ctx.shadowColor = "rgba(0,0,0,0.3)";
                    ctx.shadowBlur = 4;
                }

                ctx.fillText(prize.text, radius - 60, 12);
                ctx.restore();
            });
        }

        function getPrizeIndex() {
            let random = Math.random() * totalProb;
            for (let i = 0; i < prizes.length; i++) {
                if (random < prizes[i].prob) return i;
                random -= prizes[i].prob;
            }
            return prizes.length - 1;
        }

        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;
            document.getElementById('spinBtn').disabled = true;

            // --- éŸ³æ•ˆè™•ç†å€å¡Š Start ---
            
            // 1. æ’­æ”¾è½‰å‹•éŸ³æ•ˆ
            spinSound.currentTime = 0;
            spinSound.play().catch(error => console.log("æ’­æ”¾å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨è¨­å®š:", error));

            // 2. ç‚ºäº†æ‡‰å° iOS/Android é™åˆ¶ï¼Œæˆ‘å€‘å…ˆ"è§£é–"ä¸­çéŸ³æ•ˆ
            // æ’­æ”¾å®ƒç„¶å¾Œç«‹åˆ»æš«åœï¼Œé€™æ¨£ 8 ç§’å¾Œç¨‹å¼å‘¼å«å®ƒæ™‚æ‰ä¸æœƒè¢«æ“‹
            winSound.play().then(() => {
                winSound.pause();
                winSound.currentTime = 0;
            }).catch(error => console.log("ä¸­çéŸ³æ•ˆé è¼‰å¤±æ•—:", error));
            
            // --- éŸ³æ•ˆè™•ç†å€å¡Š End ---

            const winningIndex = getPrizeIndex();
            const prizeCenterAngle = (winningIndex * sliceAngle) + (sliceAngle / 2);
            
            const halfSlice = sliceAngle / 2;
            const safeZone = halfSlice * 0.8;
            const randomOffset = (Math.random() * 2 * safeZone) - safeZone;

            let targetAngleRelativeToZero = (360 - prizeCenterAngle) + randomOffset;
            while (targetAngleRelativeToZero < 0) targetAngleRelativeToZero += 360;

            const currentMod = currentRotation % 360;
            let distanceToTarget = targetAngleRelativeToZero - currentMod;
            if (distanceToTarget < 0) distanceToTarget += 360;

            const extraSpins = 360 * 8; 
            const finalRotation = currentRotation + extraSpins + distanceToTarget;

            canvas.style.transition = 'transform 8s cubic-bezier(0.1, 0.7, 0.1, 1)';
            canvas.style.transform = `rotate(${finalRotation}deg)`;
            
            currentRotation = finalRotation;

            // 8ç§’å¾Œåœæ­¢
            setTimeout(() => {
                isSpinning = false;
                document.getElementById('spinBtn').disabled = false;
                
                // åœæ­¢è½‰å‹•éŸ³æ•ˆ
                spinSound.pause();
                spinSound.currentTime = 0;

                // æ’­æ”¾ä¸­çéŸ³æ•ˆ
                winSound.play().catch(e => console.log(e));

                showResult(prizes[winningIndex]);
            }, 8000);
        }

        function showResult(prize) {
            document.getElementById('modalPrizeName').innerText = prize.text;
            document.getElementById('modalPrizeDesc').innerText = prize.fullText;
            document.getElementById('resultModal').style.display = 'flex';
        }

        function closeModal() {
            if(confirm("ç¢ºå®šå·²æ ¸éŠ·çå“ä¸¦é—œé–‰è¦–çª—å—ï¼Ÿ")) {
                document.getElementById('resultModal').style.display = 'none';
                // é—œé–‰è¦–çª—æ™‚ä¹Ÿç¢ºä¿éŸ³æ•ˆåœæ­¢
                winSound.pause();
                winSound.currentTime = 0;
            }
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {});
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        drawWheel();

    </script>
</body>
</html>
